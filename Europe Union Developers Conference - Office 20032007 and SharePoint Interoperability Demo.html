<html><head>
<meta charset='UTF-8'>
<link href='resource/bootstrap.min.css' rel='Stylesheet' type='text/css' />
<link href='resource/style.css' rel='Stylesheet' type='text/css' />
</head>
<body>
<div id='page'>
<h1 class='entry-title'>Europe Union Developers Conference - Office 2003/2007 and SharePoint Interoperability Demo</h1>
 <a class='url fn n profile-usercard-hover' href='https://social.msdn.microsoft.com/profile/mszCool [mario]' target='_blank'>mszCool [mario]</a>
<time>    2/19/2007 8:23:00 AM</time>
<hr>
<div id='content'><P>The European Union developers conference last Thursday and Friday was really very exciting. It's the feeling that makes this conference different to other conferences and sessions I've given so far. I'd like to share the prototype (with all sources etc.) I did at the presentation for the EU as I really think it hits the spot for one, very important message: the capabilities of interoperability of Office through the .NET Framework and especially through it's new file format, the <A href="http://www.ecma-international.org/news/PressReleases/PR_TC45_Dec2006.htm" mce_href="http://www.ecma-international.org/news/PressReleases/PR_TC45_Dec2006.htm">ECMA Office Open XML File Formats</A>. </P>
<P><A class="" title="Office Interop Solution" href="http://blogs.msdn.com/mszcool/attachment/1715448.ashx" mce_href="http://blogs.msdn.com/mszcool/attachment/1715448.ashx">You can download the prototype here... (attachment of this blog entry)</A></P>
<P>The following picture outlines the scenario I've taken as a business case for the prototype:</P>
<P><A href="media/TNBlogsFS/BlogFileStorage/blogs_msdn/mszcool/WindowsLiveWriter/EuropeUnionDevelopersConferenceOffice200_A597/Business%20Scenario%5B5%5D.jpg" original-url="http://blogs.msdn.com/blogfiles/mszcool/WindowsLiveWriter/EuropeUnionDevelopersConferenceOffice200_A597/Business%20Scenario%5B5%5D.jpg" mce_href="http://blogs.msdn.com/blogfiles/mszcool/WindowsLiveWriter/EuropeUnionDevelopersConferenceOffice200_A597/Business%20Scenario%5B5%5D.jpg"><IMG height=318 src="media/TNBlogsFS/BlogFileStorage/blogs_msdn/mszcool/WindowsLiveWriter/EuropeUnionDevelopersConferenceOffice200_A597/Business%20Scenario_thumb%5B5%5D.jpg" original-url="http://blogs.msdn.com/blogfiles/mszcool/WindowsLiveWriter/EuropeUnionDevelopersConferenceOffice200_A597/Business%20Scenario_thumb%5B5%5D.jpg" width=483 mce_src="http://blogs.msdn.com/blogfiles/mszcool/WindowsLiveWriter/EuropeUnionDevelopersConferenceOffice200_A597/Business%20Scenario_thumb%5B5%5D.jpg"></A></P>
<P>The scenario takes an organization performing managing several IT projects. Each project manager is responsible to submit project budget reports in a regular interval to a server.&nbsp;The organization manager then generates a consolidated budget report in word for getting the big picture on the company's budget-situation with another application that gathers business information from the submitted budget reports and summarizes it in a consolidated word document based&nbsp;report. The core requirement: interoperability with other platforms and between Office versions. So any client-based functionality below runs on Office 2003 and Office 2007 including the VSTO solution (see blow) and the document generated on the back end. Web services and document generation is provided with .NET and Java.</P>
<P><STRONG><EM>The back end of our system - Windows SharePoint Services 2007</EM></STRONG></P>
<P>The back end for our system is&nbsp;a Windows SharePoint Services 2007 site with lists for available projects, departments and cost categories as well as a document library for hosting the Visual Studio Tools for Office based Excel project budget reports. The information from SharePoint is exposed through custom web services which are providing the information via WS-I compliant, strongly typed web service facades&nbsp;(opposed to the out-of-the-box, very "generic" types of web services provided by WSS). Here is one example code excerpt for accessing the information of SharePoint within a custom web service (the method is encapsulated within a service implementation class that is hosted by the web service facade):</P>
<P><FONT size=1>public ProjectsResponseMessage GetProjects(ProjectsRequestMessage request)<BR>{</FONT></P>
<BLOCKQUOTE>
<P><FONT size=1>ProjectsResponseMessage response = new ProjectsResponseMessage(); </FONT></P>
<P><FONT size=1>// Connect to the SharePoint site<BR>SPSite site = new SPSite(ConfigurationManager.AppSettings["SPSite"]);&nbsp; <BR>// SPSite URL passed to SPSite constructor is for example </FONT><A href="http://mszcool:8081/eusite/Projects%20List" mce_href="http://mszCool:8081/eusite/Projects%20List"><FONT size=1>http://mszCool:8081/eusite/</FONT></A><BR><FONT size=1>SPList projectsList = web.GetList(ConfigurationManager.AppSettings["ProjectList"]);&nbsp; <BR>// SPList URL passed to GetList for example </FONT><A href="http://mszcool:8081/eusite/Projects%20List" mce_href="http://mszCool:8081/eusite/Projects%20List"><FONT size=1>http://mszCool:8081/eusite/Projects%20List</FONT></A><FONT size=1> </FONT>
<P><FONT size=1>// Run through the library's entries and get data from the document<BR>foreach (SPListItem project in projectsList.Items)<BR>{<BR>&nbsp;&nbsp;&nbsp; ProjectEntity p = new ProjectEntity();<BR>&nbsp;&nbsp;&nbsp; p.ProjectID = int.Parse(project["Project NR"].ToString());<BR>&nbsp;&nbsp;&nbsp; p.ProjectName = project["Title"].ToString();<BR>&nbsp;&nbsp;&nbsp; p.Description = project["Description"].ToString();<BR>&nbsp;&nbsp;&nbsp; p.StartDate = DateTime.Parse(project["Start"].ToString());<BR>&nbsp;&nbsp;&nbsp; p.EndDate = DateTime.Parse(project["End"].ToString());<BR>&nbsp;&nbsp;&nbsp; response.Projects.Add(p);<BR>} </FONT>
<P><FONT size=1>return response;</FONT></P></BLOCKQUOTE>
<P><FONT size=1>}</FONT></P>
<P><STRONG><EM>The first front-end: A Visual Studio 2005 Tools For Office Document Level Customization</EM></STRONG></P>
<P>The project budget report is a <STRONG>Visual Studio Tools for Office</STRONG> document level customization, that retrieves information necessary for filling out the report from the server such as department information, a list of available projects with details and cost center categories (hardware costs, software costs etc.). All the information is managed on the previously introduced <STRONG>Windows SharePoint Services 2007</STRONG> and accessible through the previously introduced web services. Finally report then gets submitted as a old, binary Excel SpreadSheet (.XLS) to SharePoint to demonstrate that even accessing binary file formats is possible with VSTO without having Office clients installed on the server. VSTO uses cached data islands to store an XML-serialized version of cached data within the binary format's extensibility points. With Visual Studio ORCAS this data islands will leverage the Custom XML data islands extensibility points of the ECMA Office Open XML file formats. </P>
<P><FONT face="Lucida Console" size=1>public partial class Sheet1<BR>{<BR>&nbsp;&nbsp;&nbsp; </FONT><STRONG><EM><FONT face="Lucida Console" size=1>[Cached]<BR>&nbsp;&nbsp;&nbsp; public BudgetReportEntity ReportData; </FONT></EM></STRONG>
<P><FONT face="Lucida Console" size=1>&nbsp;&nbsp;&nbsp; private ProjectSelection ProjectPanel;<BR>&nbsp;&nbsp;&nbsp; private DepartmentSelection DepartmentPanel; </FONT>
<P><FONT face="Lucida Console" size=1>&nbsp;&nbsp;&nbsp; private ProjectProxy.ProjectService ProjectProxyInstance;<BR>&nbsp;&nbsp;&nbsp; private DepartmentProxy.DepartmentService DepartmentProxyInstance; </FONT>
<P><FONT face="Lucida Console" size=1>&nbsp;&nbsp;&nbsp; private void Sheet1_Startup(object sender, System.EventArgs e)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // ...<BR>&nbsp;&nbsp;&nbsp; }</FONT> 
<P><FONT face="Lucida Console" size=1>&nbsp;&nbsp;&nbsp; // ... rest of the implementation<BR>}</FONT> 
<P>Within the SharePoint services web service implementation I am accessing the budget report in a web service that provides the BudgetReportEntity business data through a web service as follows:</P>
<P><FONT face="Lucida Console" size=1>public BudgetReportResponseMessage GetReports(BudgetReportRequestMessage request)<BR>{</FONT></P>
<BLOCKQUOTE>
<P><FONT face="Lucida Console" size=1>BudgetReportResponseMessage response = new BudgetReportResponseMessage(); </FONT></P>
<P><FONT face="Lucida Console" size=1>// Connect to the SharePoint site<BR>SPSite site = new SPSite(ConfigurationManager.AppSettings["SPSite"]);<BR>SPWeb web = site.OpenWeb();<BR>SPList docLibrary = web.GetList(ConfigurationManager.AppSettings["BudgetLibrary"]); </FONT>
<P><FONT face="Lucida Console" size=1>// Run through the library's entries and get data from the document<BR>foreach (SPListItem report in docLibrary.Items)<BR>{<BR>&nbsp;&nbsp;&nbsp; // Budget report for deserialization<BR>&nbsp;&nbsp;&nbsp; Budget.Entities.BudgetReportEntity reportEntity = null; </FONT>
<P><FONT face="Lucida Console" size=1>&nbsp;&nbsp;&nbsp; // Get the file and open a stream<BR>&nbsp;&nbsp;&nbsp; byte[] fileBytes = report.File.OpenBinary();<BR>&nbsp;&nbsp;&nbsp;</FONT><FONT size=1><FONT face="Lucida Console"><STRONG> ServerDocument document = <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new ServerDocument(fileBytes, report.File.Name);<BR></STRONG>&nbsp;&nbsp;&nbsp; foreach(CachedDataHostItem host <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in document.CachedData.HostItems)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // A host item is a sheet hosting data in case of excel<BR>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; foreach (CachedDataItem item in host.CachedData)<BR>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; </FONT></FONT><FONT size=1><FONT face="Lucida Console"><STRONG>// There is one report in our item<BR>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; StringReader sr = new StringReader(item.Xml);<BR>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; XmlTextReader xtr = new XmlTextReader(sr);<BR>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; reportEntity = <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BudgetSerializer.Deserialize(xtr) <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; as BudgetReportEntity;<BR>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; response.Reports.Add(reportEntity);<BR></STRONG>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }<BR>} </FONT></FONT>
<P><FONT face="Lucida Console" size=1>return response;</FONT></P></BLOCKQUOTE>
<P><FONT face="Lucida Console" size=1>}</FONT></P>
<P><STRONG><EM>Generating Consolidated Reports using Office Open XML File Formats and Java</EM></STRONG></P>
<P>Out of the submitted budget reports a consolidated budget report for Word needs to be generated. To demonstrate interoperability with Java / J2EE environments, I've written a .NET web service that extracts the business data from the old, binary format through VSTO 2005 ServerDocument programming model (see above)&nbsp;and make it available through a web service to another, Java-based service. This Java Based service (which I've implemented as Java Swing Client for simplicity) generates a Word document based on the ECMA Office Open XML File formats standard (DOCX). For that purpose I've created a Office document based on the new file format which is attached to a custom XML schema. Why did I use the Office 2003-approach for attaching to schemas instead of Custom XML schemas? Well, the 2003-approach is supported on both Office versions, 2003 and 2007. Therefore using the file converters the DOCX can be opened without any troubles with Office 2003 and Office 2007 as this functionality is supported with both versions.</P>
<P><A href="media/TNBlogsFS/BlogFileStorage/blogs_msdn/mszcool/WindowsLiveWriter/EuropeUnionDevelopersConferenceOffice200_A597/image%5B4%5D.png" original-url="http://blogs.msdn.com/blogfiles/mszcool/WindowsLiveWriter/EuropeUnionDevelopersConferenceOffice200_A597/image%5B4%5D.png" mce_href="http://blogs.msdn.com/blogfiles/mszcool/WindowsLiveWriter/EuropeUnionDevelopersConferenceOffice200_A597/image%5B4%5D.png" atomicselection="true"><IMG height=457 src="media/TNBlogsFS/BlogFileStorage/blogs_msdn/mszcool/WindowsLiveWriter/EuropeUnionDevelopersConferenceOffice200_A597/image_thumb%5B4%5D.png" original-url="http://blogs.msdn.com/blogfiles/mszcool/WindowsLiveWriter/EuropeUnionDevelopersConferenceOffice200_A597/image_thumb%5B4%5D.png" width=445 mce_src="http://blogs.msdn.com/blogfiles/mszcool/WindowsLiveWriter/EuropeUnionDevelopersConferenceOffice200_A597/image_thumb%5B4%5D.png"></A> </P>
<P>So generating the document is nothing else than opening the ZIP-package (the Office Open XML File is nothing else than a ZIP package), finding the word-document XML document and then finding, duplicating and inserting information into the XML-nodes of the custom schema (as "customXml" element with an "element" attribute). To have some abstraction for the relationships between XML files within a DOCX(ZIP)-package&nbsp;in place a packaging API would make accessing the parts of the package more convenient (but finally is optional). The .NET Framework 3.0 includes&nbsp;one with classes in the System.IO.Packaging namespace and thanks to <A href="http://julien.chable.net/" mce_href="http://julien.chable.net">Julien Chable</A> a&nbsp;wrapper around&nbsp;java.util.ZipFile exists as packaging API for Java as well.&nbsp;To demonstrate the same on .NET 3.0, I've also written a .NET command line application to generate the same budget report out of Microsoft's environment using the System.IO.Packaging API. So you can compare these two applications to see that the difference of generating a document on the server between Java and .NET is not really that large. Of course when using the <A href="http://www.microsoft.com/downloads/details.aspx?FamilyID=941b3470-3ae9-4aee-8f43-c6bb74cd1466&amp;DisplayLang=en" mce_href="http://www.microsoft.com/downloads/details.aspx?FamilyID=941b3470-3ae9-4aee-8f43-c6bb74cd1466&amp;DisplayLang=en">File compatibility packages</A> for Office 2003, the files stored in the new Open XML file formats&nbsp;can&nbsp;be processed on Office 2003,&nbsp;Office XP and Office 2000 as well.&nbsp;</P>
<P><STRONG><EM>Final Words</EM></STRONG></P>
<P>Attached to this post you can find the sources of the sample scenario introduced above. I've used the following infrastructure for creating and testing the applications on both platforms (please note my comments on configuration settings which will affect you when you try to run the samples within your environment):</P>
<UL>
<LI><STRONG><EM>Requirements for the Windows / SharePoint / .NET parts:</EM></STRONG> 
<UL>
<LI>Windows Server 2003 SP1 or Windows Server 2003 R2 
<LI><A href="http://www.microsoft.com/downloads/details.aspx?FamilyID=0856eacb-4362-4b0d-8edd-aab15c5e04f5&amp;DisplayLang=en" mce_href="http://www.microsoft.com/downloads/details.aspx?FamilyID=0856eacb-4362-4b0d-8edd-aab15c5e04f5&amp;DisplayLang=en">.NET Framework 2.0</A> and <A href="http://www.microsoft.com/downloads/details.aspx?FamilyID=10cc340b-f857-4a14-83f5-25634c3bf043&amp;DisplayLang=en" mce_href="http://www.microsoft.com/downloads/details.aspx?FamilyID=10cc340b-f857-4a14-83f5-25634c3bf043&amp;DisplayLang=en">.NET Framework 3.0</A> 
<LI>IIS 6.0 installed with <A href="http://www.microsoft.com/downloads/details.aspx?FamilyID=d51730b5-48fc-4ca2-b454-8dc2caf93951&amp;DisplayLang=en" mce_href="http://www.microsoft.com/downloads/details.aspx?FamilyID=d51730b5-48fc-4ca2-b454-8dc2caf93951&amp;DisplayLang=en">Windows SharePoint Services 2007</A> 
<UL>
<LI>The site I've used was <A href="http://mszcool:8081/eusite" mce_href="http://mszCool:8081/eusite">http://mszCool:8081/eusite</A> which is important for the web.config configuration of my web service wrappers which are referring to this site in web.config app-settings.</LI></UL>
<LI><A href="http://www.microsoft.com/downloads/details.aspx?FamilyID=bb4a75ab-e2d4-4c96-b39d-37baf6b5b1dc&amp;DisplayLang=en" mce_href="http://www.microsoft.com/downloads/details.aspx?FamilyID=bb4a75ab-e2d4-4c96-b39d-37baf6b5b1dc&amp;DisplayLang=en">Visual Studio 2005 SP1</A> 
<LI><A href="http://msdn2.microsoft.com/en-us/office/aa905533.aspx" mce_href="http://msdn2.microsoft.com/en-us/office/aa905533.aspx">Visual Studio 2005 Tools for Office and Visual Studio 2005 Tools for Office Second Edition</A> 
<UL>
<LI>My web service wrappers around SharePoint ran on <A href="http://localhost/EUServices" mce_href="http://localhost/EUServices">http://localhost/EUServices</A> which is important to the app.config configuration of my VSTO based solutions and .NET and Java applications which are accessing the web services</LI></UL>
<LI>Office 2003 and Office 2007 client applications (to test compatibility between office versions) 
<LI>Optional: <A href="http://www.microsoft.com/downloads/details.aspx?FamilyID=941b3470-3ae9-4aee-8f43-c6bb74cd1466&amp;DisplayLang=en" mce_href="http://www.microsoft.com/downloads/details.aspx?FamilyID=941b3470-3ae9-4aee-8f43-c6bb74cd1466&amp;DisplayLang=en">Office Open XML File Format compatibility packages</A></LI></UL>
<LI><STRONG><EM>Requirements for the Java-based web services and Java-application for generating the documents</EM></STRONG> 
<UL>
<LI>Java2 Standard Edition 1.5.x (JDK 1.5.x) 
<LI><A href="http://tomcat.apache.org/download-55.cgi#5.5.20" mce_href="http://tomcat.apache.org/download-55.cgi#5.5.20">Apache Tomcat 5.5.20</A> 
<UL>
<LI>Running on <A href="http://localhost:8780/" mce_href="http://localhost:8780">http://localhost:8780</A> on my machine which is important if you want to call the Java-based web services I am providing in the sample as&nbsp;possible replacement&nbsp;for some the .NET based web services to show Office client interoperability with Java-based back end systems.</LI></UL>
<LI><A href="http://ws.apache.org/axis2/" mce_href="http://ws.apache.org/axis2/">Apache Axis2 version 1.1.1 for Java web services</A> 
<LI><A href="http://www-128.ibm.com/developerworks/eclipse/downloads" mce_href="http://www-128.ibm.com/developerworks/eclipse/downloads">Eclipse Callisto Enterprise Project Bundle from IBM</A> 
<LI>The Office Open XML Packaging API for Java from <A href="http://www.openxmldeveloper.org/" mce_href="http://www.openxmldeveloper.org">www.openxmldeveloper.org</A> from the following article (many thanks to <A href="http://julien.chable.net/" mce_href="http://julien.chable.net">Julien Chable</A> who wrote the Packaging API wrapper for Java): <A href="http://openxmldeveloper.org/articles/OpenXMLandJava.aspx" mce_href="http://openxmldeveloper.org/articles/OpenXMLandJava.aspx">Open XML and Java</A></LI></UL></LI></UL>
<P>Finally I think this prototype really shows important concepts of what's possible with Microsoft Office, .NET Framework and the new ECMA Office Open XML File Formats in heterogeneous environments. As long as&nbsp;your web services are really WS-I compliant and as long as you stay with&nbsp;features which are available on more than one&nbsp;Office version it's&nbsp;really possible implementing a solution that works well in heterogeneous environments. Feel free to get in touch with me if you have any questions on my solution.&nbsp;</P>
<p><a href="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Components.PostAttachments/00/01/71/54/48/OfficeInteroperabilityPrototype.zip" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-components-postattachments/00-01-71-54-48/OfficeInteroperabilityPrototype.zip">OfficeInteroperabilityPrototype.zip</a></p></div>
</div></body>
<script type='text/javascript' src='resource/jquery-1.12.1.min.js'></script>
<script type='text/javascript' src='resource/replace.js'></script>
</html>
