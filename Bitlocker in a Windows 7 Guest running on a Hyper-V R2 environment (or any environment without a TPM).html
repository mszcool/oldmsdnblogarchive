<html><head>
<meta charset='UTF-8'>
<link href='resource/bootstrap.min.css' rel='Stylesheet' type='text/css' />
<link href='resource/style.css' rel='Stylesheet' type='text/css' />
</head>
<body>
<div id='page'>
<h1 class='entry-title'>Bitlocker in a Windows 7 Guest running on a Hyper-V R2 environment (or any environment without a TPM)</h1>
 <a class='url fn n profile-usercard-hover' href='https://social.msdn.microsoft.com/profile/mszCool [mario]' target='_blank'>mszCool [mario]</a>
<time>    2/3/2010 1:30:00 AM</time>
<hr>
<div id='content'><p>Today I am ill and lying in the bed with a medium temperature… but honestly, I can’t lie in bed the whole day doing nothing, even when being ill… so I tried something…</p>  <p>First of all, I haven’t invented this article, I just modified it to match a Windows 7 installation running in a Hyper-V R2 environment. The original information is coming from <a href="http://blogs.msdn.com/virtual_pc_guy/archive/2008/01/23/using-bitlocker-under-virtual-pc-virtual-server.aspx">here</a>, <a href="http://www.sevenforums.com/tutorials/4681-bitlocker-drive-encryption-windows-7-drive-turn-off-no-tpm.html">here</a> and <a href="http://www.ravichaganti.com/blog/?p=64">here</a>.</p>  <p>To use Bitlocker in a Windows 7-Guest on a Hyper-V environment follow these steps:</p>  <ol>   <li>Create a new virtual floppy disk. </li>    <li>Create a new guest VM with the settings you need. </li>    <li>Install Windows 7 Ultimate on that guest VM. Other than described in the previous articles <a href="http://www.ravichaganti.com/blog/?p=64">here</a>, usage of diskpart is not necessary. Just perform an ordinary install as you would do on a physical or any other VM where you don’t need to use Bitlocker. </li>    <li>Now the trick comes – you need to update the group policy to allow Bitlocker running on a machine without a TPM-chip installed, as Hyper-V. For this purpose follow the steps below: </li>    <ol>     <ol>       <li>Open a Command Prompt as Administrator </li>        <li>Type gpedit.msc and hit ENTER to start the Group Policy Editor. </li>        <li>Navigate to “Computer Configuration” - “Administrative Templates” - “Windows Components” - “Bitlocker Drive Encryption” - “Operating System Drives”          <br />&#160;<a href="media/TNBlogsFS/BlogFileStorage/blogs_msdn/mszcool/WindowsLiveWriter/BitlockerinaWindows7GuestrunningonaHyper_A2B9/image_6.png" original-url="http://blogs.msdn.com/blogfiles/mszcool/WindowsLiveWriter/BitlockerinaWindows7GuestrunningonaHyper_A2B9/image_6.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="media/TNBlogsFS/BlogFileStorage/blogs_msdn/mszcool/WindowsLiveWriter/BitlockerinaWindows7GuestrunningonaHyper_A2B9/image_thumb_2.png" original-url="http://blogs.msdn.com/blogfiles/mszcool/WindowsLiveWriter/BitlockerinaWindows7GuestrunningonaHyper_A2B9/image_thumb_2.png" width="449" height="338" /></a> </li>        <li>Double-Click “Require additional authentication at startup” </li>        <li>In here, configure as shown below: Enable the policy and check the “Allow Bitlocker without compatible TPM” option:          <br /><a href="media/TNBlogsFS/BlogFileStorage/blogs_msdn/mszcool/WindowsLiveWriter/BitlockerinaWindows7GuestrunningonaHyper_A2B9/image_8.png" original-url="http://blogs.msdn.com/blogfiles/mszcool/WindowsLiveWriter/BitlockerinaWindows7GuestrunningonaHyper_A2B9/image_8.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="media/TNBlogsFS/BlogFileStorage/blogs_msdn/mszcool/WindowsLiveWriter/BitlockerinaWindows7GuestrunningonaHyper_A2B9/image_thumb_3.png" original-url="http://blogs.msdn.com/blogfiles/mszcool/WindowsLiveWriter/BitlockerinaWindows7GuestrunningonaHyper_A2B9/image_thumb_3.png" width="449" height="338" /></a>&#160; </li>     </ol>   </ol>    <li>Switch back to the command prompt and type the following command:      <br /><strong>cscript c:\Windows\System32\manage-bde.wsf -on C: -rp -sk A:</strong>      <br /><a href="media/TNBlogsFS/BlogFileStorage/blogs_msdn/mszcool/WindowsLiveWriter/BitlockerinaWindows7GuestrunningonaHyper_A2B9/image_10.png" original-url="http://blogs.msdn.com/blogfiles/mszcool/WindowsLiveWriter/BitlockerinaWindows7GuestrunningonaHyper_A2B9/image_10.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="media/TNBlogsFS/BlogFileStorage/blogs_msdn/mszcool/WindowsLiveWriter/BitlockerinaWindows7GuestrunningonaHyper_A2B9/image_thumb_4.png" original-url="http://blogs.msdn.com/blogfiles/mszcool/WindowsLiveWriter/BitlockerinaWindows7GuestrunningonaHyper_A2B9/image_thumb_4.png" width="449" height="338" /></a> </li>    <li>Now closely look at the output of the command prompt window. It asks you to restart your machine for validating Bitlocker encryption. Make sure that your previously created and formatted virtual floppy disk remains attached in the VM-settings. Otherwise you can’t boot the machine as the key is stored on this virtual floppy.</li>    <li>Reboot your machine.</li>    <li>After the reboot, Bitlocker encryption will start automatically.</li> </ol>  <p><strong><u>Of course you might ask, why I tried this out!?</u></strong></p>  <p>Well, it happens sometimes that when preparing a presentation or working on a tricky problem for a customer, it’s better doing this at home where I can work quietly and therefore much more productive than in our Microsoft office where every n minutes someone passes by and asks questions or starts a discussion.</p>  <p>At home I am working on my power workstations which are much faster and more powerful than any notebook. The problem - while working at home, I often need full access to the corporate network. This is possible, only, if you have a machine joined to our Microsoft domain and – since the release of Windows 7 – that has Bitlocker installed. And honestly, I don’t want to join my private machine into the corp.-network, so my idea was running a VM on my Hyper-V server at home, that is joined to the corp.-domain</p>  <p>I had a similar idea for another reason – as you know we’re in a team where we’re working a lot with pre-release and beta-software. As pre-release software is typically not performance-optimized and carries a lot of debug-symbols etc. with it, it’s performance requirements are typically higher. So it’s better running that stuff on a physical system. So what my thought is: I have a stable, released-software-only VM running on a Hyper-V in our office, as well, that is joined to the corporate network and that I can use while installing another demo-environment on my physical machine. And again, the virtual machine joined to corp-net must use Bitlocker per our policy. So, another case where Bitlocker in a VM makes sense.</p></div>
</div></body>
<script type='text/javascript' src='resource/jquery-1.12.1.min.js'></script>
<script type='text/javascript' src='resource/replace.js'></script>
</html>
