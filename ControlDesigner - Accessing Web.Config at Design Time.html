<html><head>
<meta charset='UTF-8'>
<link href='resource/bootstrap.min.css' rel='Stylesheet' type='text/css' />
<link href='resource/style.css' rel='Stylesheet' type='text/css' />
</head>
<body>
<div id='page'>
<h1 class='entry-title'>ControlDesigner - Accessing Web.Config at Design Time</h1>
 <a class='url fn n profile-usercard-hover' href='https://social.msdn.microsoft.com/profile/mszCool [mario]' target='_blank'>mszCool [mario]</a>
<time>    6/30/2004 4:41:00 PM</time>
<hr>
<div id='content'><P>TechEd Europe is quite cool till now. Some interesting sessions (especially things about Team System and Web Services) and - if you have read one of my older blog entries - I am at the <EM>ask the experts</EM> getting some interesting questions from attendees. Well, one of the more interesing questions I got was how to access the web.config through an Add-In or Control Designer at design time from within Visual Studio .NET. Therefore I decided to publish some code to demonstrate that.</P>
<P>When you are writing an Add-In for Visual Studio .NET you have a complete object model for accessing all the functions provided by Visual Studio. The object model for the development environment is called DTE (Design Time Environment) and currently only available through COM-Interop (add a reference to the COM type library "Microsoft Development Environment 7.0"). Just look for "DTE" in the MSDN library and you'll find some interesting entries. Now take a look at the following code (which is nothing else than a control designer for a custom&nbsp;ASP.NET web control) - which acutally is the answer for the question I got at the booths:</P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 'Courier New'">public</SPAN><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"> <SPAN style="COLOR: blue">class</SPAN> TestControlDesigner : System.Web.UI.Design.ControlDesigner<?xml:namespace prefix = o ns = "urn:schemas-microsoft-com:office:office" /><o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'">{</SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 1">&nbsp; </SPAN><SPAN style="COLOR: blue">public</SPAN> <SPAN style="COLOR: blue">override</SPAN> <SPAN style="COLOR: blue">string</SPAN> GetDesignTimeHtml()<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 1">&nbsp; </SPAN>{<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 2">&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">string</SPAN> html = "found nothing";<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 2">&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">try</SPAN> <o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 2">&nbsp;&nbsp; </SPAN>{<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: green">// Go through the design time environment, look for the config and read some data<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><STRONG><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>EnvDTE.DTE devenv = <SPAN style="COLOR: blue">null</SPAN>;<o:p></o:p></STRONG></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><STRONG><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>devenv = (EnvDTE.DTE)System.Runtime.InteropServices.Marshal.GetActiveObject("VisualStudio.DTE.7.1");<o:p></o:p></STRONG></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><STRONG><SPAN style="mso-tab-count: 2">&nbsp;&nbsp; </SPAN><o:p></o:p></STRONG></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><STRONG><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Array projects = (System.Array)devenv.ActiveSolutionProjects;<o:p></o:p></STRONG></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">if</SPAN>((projects.Length == 0) || (projects.Length &gt; 1))<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>{<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>html = "Exactly one project must be active";<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>} <o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">else</SPAN> <o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>{<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><STRONG><SPAN style="mso-tab-count: 4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: green">// go through the items of the project to find the configuration<o:p></o:p></SPAN></STRONG></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><STRONG><SPAN style="mso-tab-count: 4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>EnvDTE.Project project = (EnvDTE.Project)(projects.GetValue(0));<o:p></o:p></STRONG></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><STRONG><SPAN style="mso-tab-count: 4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">foreach</SPAN>(EnvDTE.ProjectItem item <SPAN style="COLOR: blue">in</SPAN> project.ProjectItems)<o:p></o:p></STRONG></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><STRONG><SPAN style="mso-tab-count: 4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>{<o:p></o:p></STRONG></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: green">// if it is the configuration, then open it up<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">if</SPAN>(<SPAN style="COLOR: blue">string</SPAN>.Compare(item.Name, "web.config", <SPAN style="COLOR: blue">true</SPAN>) == 0)<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>{<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 6">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>System.IO.FileInfo info = <o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">new</SPAN> System.IO.FileInfo(project.FullName);<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 6">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>html = "&lt;b&gt;Found configuration&lt;/b&gt;";<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 6">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>html += "&lt;br&gt;" + GetConfigSetting(<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>info.Directory.FullName + "\\" + item.Name);<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>}<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 4">&nbsp;<STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </STRONG></SPAN><STRONG>}<o:p></o:p></STRONG></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>}<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 2">&nbsp;&nbsp; </SPAN>} <o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 2">&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">catch</SPAN>(Exception ex) <o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 2">&nbsp;&nbsp; </SPAN>{<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>html = "Exception occured: " + ex.Message;<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 2">&nbsp;&nbsp; </SPAN>}<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 2">&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">return</SPAN> html;<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 1">&nbsp; </SPAN>}<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><o:p>&nbsp;</o:p></SPAN></P><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><o:p>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 1">&nbsp; </SPAN><SPAN style="COLOR: blue">private</SPAN> <SPAN style="COLOR: blue">string</SPAN> GetConfigSetting(<SPAN style="COLOR: blue">string</SPAN> fileName)<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 1">&nbsp; </SPAN>{<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 2">&nbsp;&nbsp; </SPAN>System.Xml.XmlDocument doc = <SPAN style="COLOR: blue">new</SPAN> System.Xml.XmlDocument();<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 2">&nbsp;&nbsp; </SPAN>doc.Load(fileName);<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 2">&nbsp;&nbsp; </SPAN>System.Xml.XmlNode node = doc.SelectSingleNode("//appSettings/add[@key='mySetting']");<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 2">&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">if</SPAN>(node == <SPAN style="COLOR: blue">null</SPAN>)<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">return</SPAN> "&lt;font color='red'&gt;&lt;b&gt;missing configuration&lt;/b&gt;&lt;/font&gt;";<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 2">&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">else<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">return</SPAN> <SPAN style="COLOR: blue">string</SPAN>.Format("&lt;font color='blue'&gt;&lt;b&gt;setting value: {0}&lt;/b&gt;&lt;/font&gt;", node.Attributes["value"].Value);<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 1">&nbsp; </SPAN>}<o:p></o:p></SPAN></P></o:p></SPAN>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'">}</SPAN><SPAN style="FONT-SIZE: 9pt"><o:p></o:p></SPAN></P>
<P>This is a Control Designer for my custom control that needs to access information in web.config at design-time. The GetDesignTimeHtml() method returns the HTML code that will be displayed by the VS.NET designer when the control is dropped onto a UserControl or a web page. Through the following code I get access to the currently running instance of Visual Studio:</P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><STRONG><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>EnvDTE.DTE devenv = <SPAN style="COLOR: blue">null</SPAN>;<o:p></o:p></STRONG></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><STRONG><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>devenv = (EnvDTE.DTE)System.Runtime.InteropServices.Marshal.GetActiveObject("VisualStudio.DTE.7.1");<o:p></o:p></STRONG></SPAN></P>
<P>As soon as I got the instance of the development environment I can start getting the active projects and iterating through the project items. One of these items must be the web.config file of the web application (or it might be the app.config of a Windows Forms app). As soon as I have found the configuration file I can parse it through an XmlDocument - unfortunately no classes for modifying configuration files are included with .NET 1.1.</P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><STRONG><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Array projects = (System.Array)devenv.ActiveSolutionProjects;<o:p></o:p></STRONG></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">if</SPAN>((projects.Length == 0) || (projects.Length &gt; 1))<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>{<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>html = "Exactly one project must be active";<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>} <o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">else</SPAN> <o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>{<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><STRONG><SPAN style="mso-tab-count: 4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: green">// go through the items of the project to find the configuration<o:p></o:p></SPAN></STRONG></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><STRONG><SPAN style="mso-tab-count: 4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>EnvDTE.Project project = (EnvDTE.Project)(projects.GetValue(0));<o:p></o:p></STRONG></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><STRONG><SPAN style="mso-tab-count: 4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">foreach</SPAN>(EnvDTE.ProjectItem item <SPAN style="COLOR: blue">in</SPAN> project.ProjectItems)<o:p></o:p></STRONG></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><STRONG><SPAN style="mso-tab-count: 4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>{<o:p></o:p></STRONG></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: green">// if it is the configuration, then open it up<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><SPAN style="mso-tab-count: 5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">if</SPAN>(<SPAN style="COLOR: blue">string</SPAN>.Compare(item.Name, "web.config", <SPAN style="COLOR: blue">true</SPAN>) == 0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...</SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <STRONG>}</STRONG></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; tab-stops: 9.0pt 18.0pt 27.0pt 36.0pt 45.0pt 54.0pt 63.0pt 72.0pt 81.0pt 90.0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 'Courier New'"><STRONG>&nbsp;&nbsp;&nbsp;&nbsp; </STRONG>}</SPAN></P>
<P><STRONG>Debugging the control designer</STRONG></P>
<P>Unfortunately if you start debugging you will not be able to place controls onto web pages of your test web application as long as the IDE is in debug mode. Therefore for debugging a control designer for a web control you will have to open up a separate IDE with just the control project and attach to&nbsp;the other&nbsp;IDE which has the web project opened that uses the control - attach for debugging CLR code. Then switch to the other IDE, open web page designer and add the control to the page. The second IDE will switch to debugging mode (of course don't forget to set a breakpoint) and you will have the chance to debug the control designer.</P></div>
</div></body>
<script type='text/javascript' src='resource/jquery-1.12.1.min.js'></script>
<script type='text/javascript' src='resource/replace.js'></script>
</html>
